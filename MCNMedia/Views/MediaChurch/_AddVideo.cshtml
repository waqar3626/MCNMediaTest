@model MCNMedia_Dev.Models.GenericModel
@{

}

@using (Html.BeginForm("AddVideo", "MediaChurch", FormMethod.Post, new { enctype = "multipart/form-data", @id = "AddVideoForm" }))
{
    <div class="row m-0 mb-3">
        <div class="col-lg-12">
            <div class="alert alert-danger" id="addVideoErrorMessage">

            </div>

        </div>

    </div><div class="row m-0 mb-3">
        <div class="col-lg-12">
            <div class="alert alert-success" id="addVideoSuccessMessage">
                saved Successfully!
            </div>

        </div>

    </div>
    <div class="form-group row p-3" id="alertDiv11">
        <div class="col-md-12">
            <div class="alertNew alert-dangerNew"  id="alertLabel11">

            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <form asp-action="Add">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                @*<input type="hidden" asp-for="Cameras.CameraId" id="CamId" />*@


                <div class="form-group">
                    <label asp-for="Media.TabName" class="control-label">Tab Name</label>
                    <input asp-for="Media.TabName" class="form-control" id="AddMedVidTabName" />
                    <span asp-validation-for="Media.TabName" class="text-danger"></span>
                </div>

                <div class="form-group row">
                    <div class="col-12">
                        <input asp-for="Media.MediaURL" class="form-control dropify" id="VidFile" type="file" name="MediaURl3" />
                        <span asp-validation-for="Media.MediaURL" class="text-danger"></span>
                    </div>
                </div>

                <div class="form-group">
                    <div class="float-right">
                        <a onclick="AddVid()" class="btn btn-success btn-sm text-white" data-toggle="tooltip" data-placement="bottom" title="Add"><i class="mdi mdi-content-save text-white"></i>Add</a>
                        <a id="back" class="btn btn-warning btn-sm text-white " data-dismiss="modal" aria-label="Close" title="Cancel"><i class="fa fa-window-close-o text-white"></i> Cancel</a>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function () {

            $('#alertDiv11').hide();
        });
        function AddVid() {

            var ss = '';

            var VidTabName = document.getElementById('AddMedVidTabName').value;
            var formData = new FormData();
            formData.append("mediaType", "Video");
            formData.append("AddVidTabName", VidTabName);
            var input = document.getElementById('VidFile');
            var fileExtension = ['mp4', 'flv', 'avi'];
            if ($.inArray($('#VidFile').val().split('.').pop().toLowerCase(), fileExtension) == -1) {


                input = "";


            }
            if (input == '' && VidTabName == '') {
                $('#VidFile').attr('class', 'form-control border-danger');
                ss += '<label >' + "Only formats are allowed : " + fileExtension.join(', ') + '</label>';
                $('#AddMedVidTabName').attr('class', 'form-control border-danger');
                ss += '<label >Please provide a valid Tab Name </label>';

                $('#alertLabel11').html(ss);
                $('#alertDiv11').show();
                return;
                $('#AddddModal').modal('show');
            }
            else if (input == '' && VidTabName != '') {
                $('#VidFile').attr('class', 'form-control border-danger');
                ss += '<label >' + "Only formats are allowed : " + fileExtension.join(', ') + '</label>';


                $('#alertLabel11').html(ss);
                $('#alertDiv11').show();
                return;
                $('#AddddModal').modal('show');
            }
            else if (input != '' && VidTabName == '') {
                $('#AddMedVidTabName').attr('class', 'form-control border-danger');
                ss += '<label >Please provide a valid Tab Name </label>';


                $('#alertLabel11').html(ss);
                $('#alertDiv11').show();
                return;
                $('#AddddModal').modal('show');
            }
            else {
                $('#AddMedVidTabName').attr('class', 'form-control');
                $('#VidFile').attr('class', 'form-controls border-success');
                $('#alertDiv11').hide();
            }

            formData.append("mediaFile", input.files[0]);
            $('#AddddModal').modal('hide');
            displayBusyIndicator();
            $.ajax({
                type: "POST",
                url: "/MediaChurch/AddVideo/",

                data: formData,
                processData: false,  // tell jQuery not to process the data
                contentType: false,  // tell jQuery not to set contentType

                //data: { AddVidTabName: AddvidTabName, VidFile11: VidFile1 },


                success: function (result) {
                   
                    if (result.success) {
                        $('#addVideoSuccessMessage').fadeIn();
                        $('#addVideoSuccessMessage').fadeTo(2000, 500).slideUp(500, function () {
                            $("#addVideoSuccessMessage").slideUp(500);
                        });
                        sleep(5000);
                        loadVideo();
                        $('#AddVideoForm')[0].reset();
                        var IntervalTime = setTimeout($('#AddddModal').modal('hide'), 5000);
                        displayBusyIndicator2();
                    }
                    else {
                       
                        $('#AddddModal').modal('show');
                        $('#addVideoErrorMessage').html(result.responseText);
                        $('#addVideoErrorMessage').fadeIn();

                        $('#addVideoErrorMessage').fadeTo(2000, 500).slideUp(500, function () {
                            $("#addVideoErrorMessage").slideUp(500);


                        });

                    }
                },
                error: function (errormessage) {
                    //alert(errormessage.responseText);
                }
            });
        }
    </script>
}